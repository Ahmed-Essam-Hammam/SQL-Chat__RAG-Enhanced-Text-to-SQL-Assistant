[
  {
    "question": "How many customers are in Brazil?",
    "sql": "SELECT COUNT(*) FROM \"Customer\" WHERE \"Country\" = 'Brazil';"
  },
  {
    "question": "List all albums by AC/DC",
    "sql": "SELECT \"Title\" FROM \"Album\" JOIN \"Artist\" ON \"Album\".\"ArtistId\" = \"Artist\".\"ArtistId\" WHERE \"Artist\".\"Name\" = 'AC/DC';"
  },
  {
    "question": "Total sales per country",
    "sql": "SELECT \"BillingCountry\", SUM(\"Total\") FROM \"Invoice\" GROUP BY \"BillingCountry\";"
  },
  {
    "question": "What are the names of all tracks in the 'Rock' genre?",
    "sql": "SELECT t.\"Name\" FROM \"Track\" t JOIN \"Genre\" g ON t.\"GenreId\" = g.\"GenreId\" WHERE g.\"Name\" = 'Rock';"
  },
  {
    "question": "How many invoices were issued in 2009?",
    "sql": "SELECT COUNT(*) FROM \"Invoice\" WHERE strftime('%Y', \"InvoiceDate\") = '2009';"
  },
  {
    "question": "List all customers with their full names and email addresses",
    "sql": "SELECT \"FirstName\" || ' ' || \"LastName\" AS \"FullName\", \"Email\" FROM \"Customer\";"
  },
  {
    "question": "What is the total sales amount for each employee's customers?",
    "sql": "SELECT e.\"EmployeeId\", e.\"FirstName\" || ' ' || e.\"LastName\" AS \"EmployeeName\", SUM(i.\"Total\") AS \"TotalSales\" FROM \"Employee\" e JOIN \"Customer\" c ON e.\"EmployeeId\" = c.\"SupportRepId\" JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY e.\"EmployeeId\";"
  },
  {
    "question": "Find the most popular genre by number of tracks sold",
    "sql": "SELECT g.\"Name\", COUNT(il.\"TrackId\") AS \"TracksSold\" FROM \"Genre\" g JOIN \"Track\" t ON g.\"GenreId\" = t.\"GenreId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY g.\"Name\" ORDER BY \"TracksSold\" DESC LIMIT 1;"
  },
  {
    "question": "List all tracks that are longer than 5 minutes",
    "sql": "SELECT \"Name\", \"Milliseconds\" / 60000 AS \"Minutes\" FROM \"Track\" WHERE \"Milliseconds\" > 300000;"
  },
  {
    "question": "How many albums does each artist have?",
    "sql": "SELECT ar.\"Name\", COUNT(al.\"AlbumId\") AS \"AlbumCount\" FROM \"Artist\" ar LEFT JOIN \"Album\" al ON ar.\"ArtistId\" = al.\"ArtistId\" GROUP BY ar.\"Name\" ORDER BY \"AlbumCount\" DESC;"
  },
  {
    "question": "Find the top 5 customers by total spending",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", SUM(i.\"Total\") AS \"TotalSpent\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY c.\"CustomerId\" ORDER BY \"TotalSpent\" DESC LIMIT 5;"
  },
  {
    "question": "What is the average invoice total by billing country?",
    "sql": "SELECT \"BillingCountry\", AVG(\"Total\") AS \"AvgInvoiceTotal\" FROM \"Invoice\" GROUP BY \"BillingCountry\" ORDER BY \"AvgInvoiceTotal\" DESC;"
  },
  {
    "question": "List all employees and their managers",
    "sql": "SELECT e1.\"FirstName\" || ' ' || e1.\"LastName\" AS \"Employee\", e2.\"FirstName\" || ' ' || e2.\"LastName\" AS \"Manager\" FROM \"Employee\" e1 LEFT JOIN \"Employee\" e2 ON e1.\"ReportsTo\" = e2.\"EmployeeId\";"
  },
  {
    "question": "Find tracks that have never been purchased",
    "sql": "SELECT t.\"TrackId\", t.\"Name\" FROM \"Track\" t LEFT JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" WHERE il.\"InvoiceLineId\" IS NULL;"
  },
  {
    "question": "What are the top 3 selling albums by total sales?",
    "sql": "SELECT al.\"Title\", ar.\"Name\" AS \"Artist\", SUM(il.\"UnitPrice\" * il.\"Quantity\") AS \"TotalSales\" FROM \"Album\" al JOIN \"Artist\" ar ON al.\"ArtistId\" = ar.\"ArtistId\" JOIN \"Track\" t ON al.\"AlbumId\" = t.\"AlbumId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY al.\"AlbumId\" ORDER BY \"TotalSales\" DESC LIMIT 3;"
  },
  {
    "question": "How many customers were added each year?",
    "sql": "SELECT strftime('%Y', \"Customer\".\"CreateDate\") AS \"Year\", COUNT(*) AS \"NewCustomers\" FROM \"Customer\" GROUP BY \"Year\" ORDER BY \"Year\";"
  },
  {
    "question": "List all media types and the number of tracks for each",
    "sql": "SELECT mt.\"Name\", COUNT(t.\"TrackId\") AS \"TrackCount\" FROM \"MediaType\" mt LEFT JOIN \"Track\" t ON mt.\"MediaTypeId\" = t.\"MediaTypeId\" GROUP BY mt.\"Name\";"
  },
  {
    "question": "Find the total sales for each month in 2010",
    "sql": "SELECT strftime('%m', \"InvoiceDate\") AS \"Month\", SUM(\"Total\") AS \"MonthlySales\" FROM \"Invoice\" WHERE strftime('%Y', \"InvoiceDate\") = '2010' GROUP BY \"Month\" ORDER BY \"Month\";"
  },
  {
    "question": "What is the most expensive track?",
    "sql": "SELECT \"Name\", \"UnitPrice\" FROM \"Track\" ORDER BY \"UnitPrice\" DESC LIMIT 1;"
  },
  {
    "question": "List all customers who have not made any purchases",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\" FROM \"Customer\" c LEFT JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" WHERE i.\"InvoiceId\" IS NULL;"
  },
  {
    "question": "Find the average track length by genre",
    "sql": "SELECT g.\"Name\" AS \"Genre\", AVG(t.\"Milliseconds\") / 60000 AS \"AvgMinutes\" FROM \"Genre\" g JOIN \"Track\" t ON g.\"GenreId\" = t.\"GenreId\" GROUP BY g.\"Name\" ORDER BY \"AvgMinutes\" DESC;"
  },
  {
    "question": "How many invoices were above the average invoice total?",
    "sql": "SELECT COUNT(*) FROM \"Invoice\" WHERE \"Total\" > (SELECT AVG(\"Total\") FROM \"Invoice\");"
  },
  {
    "question": "List the top 5 composers by number of tracks",
    "sql": "SELECT \"Composer\", COUNT(*) AS \"TrackCount\" FROM \"Track\" WHERE \"Composer\" IS NOT NULL GROUP BY \"Composer\" ORDER BY \"TrackCount\" DESC LIMIT 5;"
  },
  {
    "question": "What is the total revenue per media type?",
    "sql": "SELECT mt.\"Name\" AS \"MediaType\", SUM(il.\"UnitPrice\" * il.\"Quantity\") AS \"Revenue\" FROM \"MediaType\" mt JOIN \"Track\" t ON mt.\"MediaTypeId\" = t.\"MediaTypeId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY mt.\"Name\" ORDER BY \"Revenue\" DESC;"
  },
  {
    "question": "Find customers who have purchased tracks from more than 5 genres",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", COUNT(DISTINCT g.\"GenreId\") AS \"GenreCount\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"Genre\" g ON t.\"GenreId\" = g.\"GenreId\" GROUP BY c.\"CustomerId\" HAVING COUNT(DISTINCT g.\"GenreId\") > 5;"
  },
  {
    "question": "What is the sales trend by quarter for 2009-2010?",
    "sql": "SELECT strftime('%Y', \"InvoiceDate\") AS \"Year\", CASE WHEN strftime('%m', \"InvoiceDate\") IN ('01','02','03') THEN 'Q1' WHEN strftime('%m', \"InvoiceDate\") IN ('04','05','06') THEN 'Q2' WHEN strftime('%m', \"InvoiceDate\") IN ('07','08','09') THEN 'Q3' ELSE 'Q4' END AS \"Quarter\", SUM(\"Total\") AS \"Sales\" FROM \"Invoice\" WHERE strftime('%Y', \"InvoiceDate\") IN ('2009','2010') GROUP BY \"Year\", \"Quarter\" ORDER BY \"Year\", \"Quarter\";"
  },
  {
    "question": "List all tracks that are in the same album as 'The Number Of The Beast'",
    "sql": "SELECT t.\"Name\" FROM \"Track\" t WHERE t.\"AlbumId\" = (SELECT \"AlbumId\" FROM \"Track\" WHERE \"Name\" = 'The Number Of The Beast') ORDER BY t.\"TrackId\";"
  },
  {
    "question": "Find the employee who sold the most by dollar amount",
    "sql": "SELECT e.\"EmployeeId\", e.\"FirstName\" || ' ' || e.\"LastName\" AS \"EmployeeName\", SUM(i.\"Total\") AS \"TotalSales\" FROM \"Employee\" e JOIN \"Customer\" c ON e.\"EmployeeId\" = c.\"SupportRepId\" JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY e.\"EmployeeId\" ORDER BY \"TotalSales\" DESC LIMIT 1;"
  },
  {
    "question": "What is the average number of tracks per album?",
    "sql": "SELECT AVG(\"TrackCount\") AS \"AvgTracksPerAlbum\" FROM (SELECT \"AlbumId\", COUNT(*) AS \"TrackCount\" FROM \"Track\" GROUP BY \"AlbumId\");"
  },
  {
    "question": "List all playlists and their total duration",
    "sql": "SELECT p.\"Name\" AS \"Playlist\", SUM(t.\"Milliseconds\") / 60000 AS \"TotalMinutes\" FROM \"Playlist\" p JOIN \"PlaylistTrack\" pt ON p.\"PlaylistId\" = pt.\"PlaylistId\" JOIN \"Track\" t ON pt.\"TrackId\" = t.\"TrackId\" GROUP BY p.\"Name\" ORDER BY \"TotalMinutes\" DESC;"
  },
  {
    "question": "Find customers who have made purchases in more than 5 different countries",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", COUNT(DISTINCT i.\"BillingCountry\") AS \"CountryCount\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY c.\"CustomerId\" HAVING COUNT(DISTINCT i.\"BillingCountry\") > 5;"
  },
  {
    "question": "What is the most popular media type by total sales?",
    "sql": "SELECT mt.\"Name\", COUNT(il.\"InvoiceLineId\") AS \"PurchaseCount\" FROM \"MediaType\" mt JOIN \"Track\" t ON mt.\"MediaTypeId\" = t.\"MediaTypeId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY mt.\"Name\" ORDER BY \"PurchaseCount\" DESC LIMIT 1;"
  },
  {
    "question": "List all artists who have no albums",
    "sql": "SELECT a.\"Name\" FROM \"Artist\" a LEFT JOIN \"Album\" al ON a.\"ArtistId\" = al.\"ArtistId\" WHERE al.\"AlbumId\" IS NULL;"
  },
  {
    "question": "Find the total sales for each customer, including customers with no sales",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", COALESCE(SUM(i.\"Total\"), 0) AS \"TotalSpent\" FROM \"Customer\" c LEFT JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY c.\"CustomerId\" ORDER BY \"TotalSpent\" DESC;"
  },
  {
    "question": "What is the most common track length range (in minutes)?",
    "sql": "SELECT CASE WHEN \"Milliseconds\" < 180000 THEN 'Under 3 min' WHEN \"Milliseconds\" BETWEEN 180000 AND 300000 THEN '3-5 min' WHEN \"Milliseconds\" BETWEEN 300001 AND 480000 THEN '5-8 min' ELSE 'Over 8 min' END AS \"LengthRange\", COUNT(*) AS \"TrackCount\" FROM \"Track\" GROUP BY \"LengthRange\" ORDER BY \"TrackCount\" DESC;"
  },
  {
    "question": "List the top 3 customers who spent the most in 2010",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", SUM(i.\"Total\") AS \"TotalSpent2010\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" WHERE strftime('%Y', i.\"InvoiceDate\") = '2010' GROUP BY c.\"CustomerId\" ORDER BY \"TotalSpent2010\" DESC LIMIT 3;"
  },
  {
    "question": "Find all tracks where the composer is also the artist name",
    "sql": "SELECT t.\"Name\", t.\"Composer\" FROM \"Track\" t JOIN \"Album\" a ON t.\"AlbumId\" = a.\"AlbumId\" JOIN \"Artist\" ar ON a.\"ArtistId\" = ar.\"ArtistId\" WHERE t.\"Composer\" LIKE '%' || ar.\"Name\" || '%' AND t.\"Composer\" IS NOT NULL;"
  },
  {
    "question": "What is the sales breakdown by genre for customers in USA?",
    "sql": "SELECT g.\"Name\" AS \"Genre\", SUM(il.\"UnitPrice\" * il.\"Quantity\") AS \"Sales\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"Genre\" g ON t.\"GenreId\" = g.\"GenreId\" WHERE c.\"Country\" = 'USA' GROUP BY g.\"Name\" ORDER BY \"Sales\" DESC;"
  },
  {
    "question": "List all invoices with their total and the number of items",
    "sql": "SELECT i.\"InvoiceId\", i.\"Total\", COUNT(il.\"InvoiceLineId\") AS \"ItemCount\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" GROUP BY i.\"InvoiceId\" ORDER BY i.\"InvoiceId\";"
  },
  {
    "question": "Find the average price per track by media type",
    "sql": "SELECT mt.\"Name\" AS \"MediaType\", AVG(t.\"UnitPrice\") AS \"AvgPrice\" FROM \"MediaType\" mt JOIN \"Track\" t ON mt.\"MediaTypeId\" = t.\"MediaTypeId\" GROUP BY mt.\"Name\" ORDER BY \"AvgPrice\" DESC;"
  },
  {
    "question": "What are the top 5 best-selling tracks?",
    "sql": "SELECT t.\"Name\", ar.\"Name\" AS \"Artist\", COUNT(il.\"InvoiceLineId\") AS \"TimesPurchased\" FROM \"Track\" t JOIN \"Album\" a ON t.\"AlbumId\" = a.\"AlbumId\" JOIN \"Artist\" ar ON a.\"ArtistId\" = ar.\"ArtistId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY t.\"TrackId\" ORDER BY \"TimesPurchased\" DESC LIMIT 5;"
  },
  {
    "question": "List all customers and their total spending by year",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", strftime('%Y', i.\"InvoiceDate\") AS \"Year\", SUM(i.\"Total\") AS \"YearlySpending\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY c.\"CustomerId\", \"Year\" ORDER BY c.\"CustomerId\", \"Year\";"
  },
  {
    "question": "Find the artist with the most albums",
    "sql": "SELECT ar.\"Name\", COUNT(al.\"AlbumId\") AS \"AlbumCount\" FROM \"Artist\" ar JOIN \"Album\" al ON ar.\"ArtistId\" = al.\"ArtistId\" GROUP BY ar.\"Name\" ORDER BY \"AlbumCount\" DESC LIMIT 1;"
  },
  {
    "question": "What is the total duration of each playlist in hours?",
    "sql": "SELECT p.\"Name\", ROUND(SUM(t.\"Milliseconds\") / 3600000.0, 2) AS \"TotalHours\" FROM \"Playlist\" p JOIN \"PlaylistTrack\" pt ON p.\"PlaylistId\" = pt.\"PlaylistId\" JOIN \"Track\" t ON pt.\"TrackId\" = t.\"TrackId\" GROUP BY p.\"Name\" ORDER BY \"TotalHours\" DESC;"
  },
  {
    "question": "List all tracks that have a unit price higher than the average",
    "sql": "SELECT \"Name\", \"UnitPrice\" FROM \"Track\" WHERE \"UnitPrice\" > (SELECT AVG(\"UnitPrice\") FROM \"Track\") ORDER BY \"UnitPrice\" DESC;"
  },
  {
    "question": "Find customers who have bought all tracks from at least one album",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", al.\"AlbumId\", al.\"Title\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"Album\" al ON t.\"AlbumId\" = al.\"AlbumId\" GROUP BY c.\"CustomerId\", al.\"AlbumId\" HAVING COUNT(DISTINCT t.\"TrackId\") = (SELECT COUNT(*) FROM \"Track\" t2 WHERE t2.\"AlbumId\" = al.\"AlbumId\");"
  },
  {
    "question": "What is the monthly sales trend for 2009?",
    "sql": "SELECT strftime('%m', \"InvoiceDate\") AS \"Month\", SUM(\"Total\") AS \"MonthlySales\" FROM \"Invoice\" WHERE strftime('%Y', \"InvoiceDate\") = '2009' GROUP BY \"Month\" ORDER BY \"Month\";"
  },
  {
    "question": "List all albums released in the 1990s",
    "sql": "SELECT al.\"Title\", ar.\"Name\" AS \"Artist\" FROM \"Album\" al JOIN \"Artist\" ar ON al.\"ArtistId\" = ar.\"ArtistId\" WHERE al.\"ReleaseYear\" BETWEEN 1990 AND 1999 ORDER BY al.\"ReleaseYear\";"
  },
  {
    "question": "Find the top 5 most popular playlists by number of tracks",
    "sql": "SELECT p.\"Name\", COUNT(pt.\"TrackId\") AS \"TrackCount\" FROM \"Playlist\" p LEFT JOIN \"PlaylistTrack\" pt ON p.\"PlaylistId\" = pt.\"PlaylistId\" GROUP BY p.\"Name\" ORDER BY \"TrackCount\" DESC LIMIT 5;"
  },
  {
    "question": "What is the average invoice total by month?",
    "sql": "SELECT strftime('%Y-%m', \"InvoiceDate\") AS \"Month\", AVG(\"Total\") AS \"AvgInvoiceTotal\" FROM \"Invoice\" GROUP BY \"Month\" ORDER BY \"Month\";"
  },
  {
    "question": "List all customers who have the same support representative",
    "sql": "SELECT e.\"FirstName\" || ' ' || e.\"LastName\" AS \"SupportRep\", GROUP_CONCAT(c.\"FirstName\" || ' ' || c.\"LastName\", ', ') AS \"Customers\" FROM \"Employee\" e JOIN \"Customer\" c ON e.\"EmployeeId\" = c.\"SupportRepId\" GROUP BY e.\"EmployeeId\";"
  },
  {
    "question": "Find tracks that appear in multiple playlists",
    "sql": "SELECT t.\"TrackId\", t.\"Name\", COUNT(pt.\"PlaylistId\") AS \"PlaylistCount\" FROM \"Track\" t JOIN \"PlaylistTrack\" pt ON t.\"TrackId\" = pt.\"TrackId\" GROUP BY t.\"TrackId\" HAVING COUNT(pt.\"PlaylistId\") > 1 ORDER BY \"PlaylistCount\" DESC;"
  },
  {
    "question": "What is the total revenue per country?",
    "sql": "SELECT i.\"BillingCountry\" AS \"Country\", SUM(i.\"Total\") AS \"Revenue\" FROM \"Invoice\" i GROUP BY i.\"BillingCountry\" ORDER BY \"Revenue\" DESC;"
  },
  {
    "question": "List all employees who have been with the company for more than 5 years",
    "sql": "SELECT \"FirstName\" || ' ' || \"LastName\" AS \"EmployeeName\", \"HireDate\" FROM \"Employee\" WHERE julianday('now') - julianday(\"HireDate\") > 1825;"
  },
  {
    "question": "Find the most expensive album (sum of track prices)",
    "sql": "SELECT al.\"Title\", ar.\"Name\" AS \"Artist\", SUM(t.\"UnitPrice\") AS \"AlbumPrice\" FROM \"Album\" al JOIN \"Artist\" ar ON al.\"ArtistId\" = ar.\"ArtistId\" JOIN \"Track\" t ON al.\"AlbumId\" = t.\"AlbumId\" GROUP BY al.\"AlbumId\" ORDER BY \"AlbumPrice\" DESC LIMIT 1;"
  },
  {
    "question": "What is the customer retention rate by year?",
    "sql": "WITH CustomerFirstPurchase AS (SELECT \"CustomerId\", MIN(strftime('%Y', \"InvoiceDate\")) AS \"FirstYear\" FROM \"Invoice\" GROUP BY \"CustomerId\"), CustomerYears AS (SELECT c.\"CustomerId\", cfp.\"FirstYear\", strftime('%Y', i.\"InvoiceDate\") AS \"PurchaseYear\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" JOIN CustomerFirstPurchase cfp ON c.\"CustomerId\" = cfp.\"CustomerId\") SELECT \"FirstYear\", COUNT(DISTINCT \"CustomerId\") AS \"NewCustomers\", COUNT(DISTINCT CASE WHEN \"PurchaseYear\" > \"FirstYear\" THEN \"CustomerId\" END) AS \"ReturningCustomers\" FROM CustomerYears GROUP BY \"FirstYear\" ORDER BY \"FirstYear\";"
  },
  {
    "question": "List all playlists that contain tracks from multiple genres",
    "sql": "SELECT p.\"PlaylistId\", p.\"Name\", COUNT(DISTINCT g.\"GenreId\") AS \"GenreCount\" FROM \"Playlist\" p JOIN \"PlaylistTrack\" pt ON p.\"PlaylistId\" = pt.\"PlaylistId\" JOIN \"Track\" t ON pt.\"TrackId\" = t.\"TrackId\" JOIN \"Genre\" g ON t.\"GenreId\" = g.\"GenreId\" GROUP BY p.\"PlaylistId\" HAVING COUNT(DISTINCT g.\"GenreId\") > 1 ORDER BY \"GenreCount\" DESC;"
  },
  {
    "question": "Find customers who have made purchases every year since their first purchase",
    "sql": "WITH CustomerYearlyPurchases AS (SELECT c.\"CustomerId\", strftime('%Y', i.\"InvoiceDate\") AS \"Year\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY c.\"CustomerId\", \"Year\") SELECT \"CustomerId\" FROM CustomerYearlyPurchases GROUP BY \"CustomerId\" HAVING COUNT(DISTINCT \"Year\") = (SELECT COUNT(DISTINCT strftime('%Y', \"InvoiceDate\")) FROM \"Invoice\");"
  },
  {
    "question": "What is the average number of tracks per purchase?",
    "sql": "SELECT AVG(\"TracksPerInvoice\") FROM (SELECT i.\"InvoiceId\", COUNT(il.\"InvoiceLineId\") AS \"TracksPerInvoice\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" GROUP BY i.\"InvoiceId\");"
  },
  {
    "question": "List all artists whose albums have an average track length over 4 minutes",
    "sql": "SELECT ar.\"ArtistId\", ar.\"Name\" AS \"ArtistName\" FROM \"Artist\" ar JOIN \"Album\" al ON ar.\"ArtistId\" = al.\"ArtistId\" JOIN \"Track\" t ON al.\"AlbumId\" = t.\"AlbumId\" GROUP BY ar.\"ArtistId\" HAVING AVG(t.\"Milliseconds\") > 240000;"
  },
  {
    "question": "Find the top 3 months with the highest sales",
    "sql": "SELECT strftime('%Y-%m', \"InvoiceDate\") AS \"Month\", SUM(\"Total\") AS \"TotalSales\" FROM \"Invoice\" GROUP BY \"Month\" ORDER BY \"TotalSales\" DESC LIMIT 3;"
  },
  {
    "question": "List all customers who have spent more than the average customer",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", SUM(i.\"Total\") AS \"TotalSpent\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY c.\"CustomerId\" HAVING SUM(i.\"Total\") > (SELECT AVG(\"TotalSpent\") FROM (SELECT SUM(\"Total\") AS \"TotalSpent\" FROM \"Invoice\" GROUP BY \"CustomerId\")) ORDER BY \"TotalSpent\" DESC;"
  },
  {
    "question": "What is the genre distribution of tracks sold?",
    "sql": "SELECT g.\"Name\" AS \"Genre\", COUNT(il.\"InvoiceLineId\") AS \"TracksSold\", ROUND(COUNT(il.\"InvoiceLineId\") * 100.0 / (SELECT COUNT(*) FROM \"InvoiceLine\"), 2) AS \"Percentage\" FROM \"Genre\" g JOIN \"Track\" t ON g.\"GenreId\" = t.\"GenreId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY g.\"Name\" ORDER BY \"TracksSold\" DESC;"
  },
  {
    "question": "List all invoices that include tracks from more than 3 albums",
    "sql": "SELECT i.\"InvoiceId\", i.\"CustomerId\", i.\"InvoiceDate\", COUNT(DISTINCT t.\"AlbumId\") AS \"AlbumCount\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" GROUP BY i.\"InvoiceId\" HAVING COUNT(DISTINCT t.\"AlbumId\") > 3;"
  },
  {
    "question": "Find the employee who manages the most employees",
    "sql": "SELECT e1.\"FirstName\" || ' ' || e1.\"LastName\" AS \"Manager\", COUNT(e2.\"EmployeeId\") AS \"DirectReports\" FROM \"Employee\" e1 JOIN \"Employee\" e2 ON e1.\"EmployeeId\" = e2.\"ReportsTo\" GROUP BY e1.\"EmployeeId\" ORDER BY \"DirectReports\" DESC LIMIT 1;"
  },
  {
    "question": "What is the total sales by hour of day?",
    "sql": "SELECT strftime('%H', \"InvoiceDate\") AS \"Hour\", SUM(\"Total\") AS \"Sales\" FROM \"Invoice\" GROUP BY \"Hour\" ORDER BY \"Hour\";"
  },
  {
    "question": "List all tracks that are longer than any track by 'Metallica'",
    "sql": "SELECT t.\"Name\", t.\"Milliseconds\" / 60000 AS \"Minutes\" FROM \"Track\" t WHERE t.\"Milliseconds\" > (SELECT MAX(t2.\"Milliseconds\") FROM \"Track\" t2 JOIN \"Album\" a ON t2.\"AlbumId\" = a.\"AlbumId\" JOIN \"Artist\" ar ON a.\"ArtistId\" = ar.\"ArtistId\" WHERE ar.\"Name\" = 'Metallica');"
  },
  {
    "question": "Find customers who have purchased tracks from every genre",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"Genre\" g ON t.\"GenreId\" = g.\"GenreId\" GROUP BY c.\"CustomerId\" HAVING COUNT(DISTINCT g.\"GenreId\") = (SELECT COUNT(*) FROM \"Genre\");"
  },
  {
    "question": "What is the cumulative sales over time?",
    "sql": "SELECT \"InvoiceDate\", \"Total\", SUM(\"Total\") OVER (ORDER BY \"InvoiceDate\") AS \"CumulativeSales\" FROM \"Invoice\" ORDER BY \"InvoiceDate\";"
  },
  {
    "question": "List all albums where the album title contains the artist name",
    "sql": "SELECT al.\"Title\", ar.\"Name\" AS \"Artist\" FROM \"Album\" al JOIN \"Artist\" ar ON al.\"ArtistId\" = ar.\"ArtistId\" WHERE al.\"Title\" LIKE '%' || ar.\"Name\" || '%';"
  },
  {
    "question": "Find the top 3 best-selling tracks for each genre",
    "sql": "WITH RankedTracks AS (SELECT g.\"Name\" AS \"Genre\", t.\"Name\" AS \"Track\", COUNT(il.\"InvoiceLineId\") AS \"SalesCount\", ROW_NUMBER() OVER (PARTITION BY g.\"GenreId\" ORDER BY COUNT(il.\"InvoiceLineId\") DESC) AS \"Rank\" FROM \"Genre\" g JOIN \"Track\" t ON g.\"GenreId\" = t.\"GenreId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY g.\"GenreId\", t.\"TrackId\") SELECT \"Genre\", \"Track\", \"SalesCount\" FROM RankedTracks WHERE \"Rank\" <= 3 ORDER BY \"Genre\", \"Rank\";"
  },
  {
    "question": "What is the percentage of customers in each country?",
    "sql": "SELECT \"Country\", COUNT(*) AS \"CustomerCount\", ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM \"Customer\"), 2) AS \"Percentage\" FROM \"Customer\" GROUP BY \"Country\" ORDER BY \"CustomerCount\" DESC;"
  },
  {
    "question": "List all invoices with a total above $20 that include at least one track longer than 5 minutes",
    "sql": "SELECT DISTINCT i.\"InvoiceId\", i.\"Total\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" WHERE i.\"Total\" > 20 AND t.\"Milliseconds\" > 300000 ORDER BY i.\"Total\" DESC;"
  },
  {
    "question": "Find the artist who has sold the most tracks overall",
    "sql": "SELECT ar.\"Name\" AS \"Artist\", COUNT(il.\"InvoiceLineId\") AS \"TracksSold\" FROM \"Artist\" ar JOIN \"Album\" al ON ar.\"ArtistId\" = al.\"ArtistId\" JOIN \"Track\" t ON al.\"AlbumId\" = t.\"AlbumId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY ar.\"ArtistId\" ORDER BY \"TracksSold\" DESC LIMIT 1;"
  },
  {
    "question": "What is the average customer lifetime value by country?",
    "sql": "SELECT c.\"Country\", AVG(c.\"TotalSpent\") AS \"AvgLifetimeValue\" FROM (SELECT \"CustomerId\", SUM(\"Total\") AS \"TotalSpent\" FROM \"Invoice\" GROUP BY \"CustomerId\") c GROUP BY c.\"Country\" ORDER BY \"AvgLifetimeValue\" DESC;"
  },
  {
    "question": "List all playlists that contain only tracks from a single artist",
    "sql": "SELECT p.\"PlaylistId\", p.\"Name\" FROM \"Playlist\" p JOIN \"PlaylistTrack\" pt ON p.\"PlaylistId\" = pt.\"PlaylistId\" JOIN \"Track\" t ON pt.\"TrackId\" = t.\"TrackId\" JOIN \"Album\" a ON t.\"AlbumId\" = a.\"AlbumId\" GROUP BY p.\"PlaylistId\" HAVING COUNT(DISTINCT a.\"ArtistId\") = 1;"
  },
  {
    "question": "Find the month with the highest average invoice total",
    "sql": "SELECT strftime('%m', \"InvoiceDate\") AS \"Month\", AVG(\"Total\") AS \"AvgTotal\" FROM \"Invoice\" GROUP BY \"Month\" ORDER BY \"AvgTotal\" DESC LIMIT 1;"
  },
  {
    "question": "List all customers who have never purchased a track from the 'Rock' genre",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\" FROM \"Customer\" c WHERE c.\"CustomerId\" NOT IN (SELECT DISTINCT i.\"CustomerId\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"Genre\" g ON t.\"GenreId\" = g.\"GenreId\" WHERE g.\"Name\" = 'Rock');"
  },
  {
    "question": "What is the total revenue by year and genre?",
    "sql": "SELECT strftime('%Y', i.\"InvoiceDate\") AS \"Year\", g.\"Name\" AS \"Genre\", SUM(il.\"UnitPrice\" * il.\"Quantity\") AS \"Revenue\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"Genre\" g ON t.\"GenreId\" = g.\"GenreId\" GROUP BY \"Year\", g.\"Name\" ORDER BY \"Year\", \"Revenue\" DESC;"
  },
  {
    "question": "List all tracks that have never been added to any playlist",
    "sql": "SELECT t.\"TrackId\", t.\"Name\" FROM \"Track\" t LEFT JOIN \"PlaylistTrack\" pt ON t.\"TrackId\" = pt.\"TrackId\" WHERE pt.\"PlaylistId\" IS NULL;"
  },
  {
    "question": "Find the top 3 employees by number of customers they support",
    "sql": "SELECT e.\"EmployeeId\", e.\"FirstName\" || ' ' || e.\"LastName\" AS \"EmployeeName\", COUNT(c.\"CustomerId\") AS \"CustomerCount\" FROM \"Employee\" e JOIN \"Customer\" c ON e.\"EmployeeId\" = c.\"SupportRepId\" GROUP BY e.\"EmployeeId\" ORDER BY \"CustomerCount\" DESC LIMIT 3;"
  },
  {
    "question": "What is the sales contribution of each genre as a percentage?",
    "sql": "WITH GenreSales AS (SELECT g.\"Name\" AS \"Genre\", SUM(il.\"UnitPrice\" * il.\"Quantity\") AS \"Sales\" FROM \"Genre\" g JOIN \"Track\" t ON g.\"GenreId\" = t.\"GenreId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY g.\"Name\") SELECT \"Genre\", \"Sales\", ROUND(\"Sales\" * 100.0 / (SELECT SUM(\"Sales\") FROM GenreSales), 2) AS \"Percentage\" FROM GenreSales ORDER BY \"Sales\" DESC;"
  },
  {
    "question": "List all customers who made purchases in the same month as their first purchase the following year",
    "sql": "WITH CustomerFirstPurchase AS (SELECT \"CustomerId\", MIN(\"InvoiceDate\") AS \"FirstPurchaseDate\" FROM \"Invoice\" GROUP BY \"CustomerId\") SELECT DISTINCT i.\"CustomerId\" FROM \"Invoice\" i JOIN CustomerFirstPurchase cfp ON i.\"CustomerId\" = cfp.\"CustomerId\" WHERE strftime('%m', i.\"InvoiceDate\") = strftime('%m', cfp.\"FirstPurchaseDate\") AND strftime('%Y', i.\"InvoiceDate\") = strftime('%Y', cfp.\"FirstPurchaseDate\", '+1 year');"
  },
  {
    "question": "Find the average track price per album",
    "sql": "SELECT al.\"AlbumId\", al.\"Title\", AVG(t.\"UnitPrice\") AS \"AvgTrackPrice\" FROM \"Album\" al JOIN \"Track\" t ON al.\"AlbumId\" = t.\"AlbumId\" GROUP BY al.\"AlbumId\" ORDER BY \"AvgTrackPrice\" DESC;"
  },
  {
    "question": "What is the most common composer among purchased tracks?",
    "sql": "SELECT t.\"Composer\", COUNT(il.\"InvoiceLineId\") AS \"PurchaseCount\" FROM \"Track\" t JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" WHERE t.\"Composer\" IS NOT NULL GROUP BY t.\"Composer\" ORDER BY \"PurchaseCount\" DESC LIMIT 1;"
  },
  {
    "question": "List all invoices where the total is greater than the sum of the track prices",
    "sql": "SELECT i.\"InvoiceId\", i.\"Total\" AS \"InvoiceTotal\", SUM(t.\"UnitPrice\") AS \"SumTrackPrices\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" GROUP BY i.\"InvoiceId\" HAVING i.\"Total\" > SUM(t.\"UnitPrice\");"
  },
  {
    "question": "Find customers who have purchased tracks from every album by a specific artist (e.g., 'U2')",
    "sql": "WITH ArtistAlbums AS (SELECT \"AlbumId\" FROM \"Album\" a JOIN \"Artist\" ar ON a.\"ArtistId\" = ar.\"ArtistId\" WHERE ar.\"Name\" = 'U2') SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" WHERE t.\"AlbumId\" IN (SELECT \"AlbumId\" FROM ArtistAlbums) GROUP BY c.\"CustomerId\" HAVING COUNT(DISTINCT t.\"AlbumId\") = (SELECT COUNT(*) FROM ArtistAlbums);"
  },
  {
    "question": "What is the sales trend for each quarter across all years?",
    "sql": "SELECT strftime('%Y', \"InvoiceDate\") AS \"Year\", CASE WHEN strftime('%m', \"InvoiceDate\") IN ('01','02','03') THEN 'Q1' WHEN strftime('%m', \"InvoiceDate\") IN ('04','05','06') THEN 'Q2' WHEN strftime('%m', \"InvoiceDate\") IN ('07','08','09') THEN 'Q3' ELSE 'Q4' END AS \"Quarter\", SUM(\"Total\") AS \"Sales\" FROM \"Invoice\" GROUP BY \"Year\", \"Quarter\" ORDER BY \"Year\", \"Quarter\";"
  },
  {
    "question": "List all media types that have never been purchased",
    "sql": "SELECT mt.\"MediaTypeId\", mt.\"Name\" FROM \"MediaType\" mt LEFT JOIN \"Track\" t ON mt.\"MediaTypeId\" = t.\"MediaTypeId\" LEFT JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" WHERE il.\"InvoiceLineId\" IS NULL;"
  },
  {
    "question": "Find the top 5 customers with the highest average invoice total",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", AVG(i.\"Total\") AS \"AvgInvoiceTotal\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY c.\"CustomerId\" ORDER BY \"AvgInvoiceTotal\" DESC LIMIT 5;"
  },
  {
    "question": "What is the total number of tracks sold per media type?",
    "sql": "SELECT mt.\"Name\" AS \"MediaType\", COUNT(il.\"InvoiceLineId\") AS \"TracksSold\" FROM \"MediaType\" mt JOIN \"Track\" t ON mt.\"MediaTypeId\" = t.\"MediaTypeId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY mt.\"Name\" ORDER BY \"TracksSold\" DESC;"
  },
  {
    "question": "List all albums where the total duration is over 60 minutes",
    "sql": "SELECT al.\"AlbumId\", al.\"Title\", SUM(t.\"Milliseconds\") / 60000 AS \"TotalMinutes\" FROM \"Album\" al JOIN \"Track\" t ON al.\"AlbumId\" = t.\"AlbumId\" GROUP BY al.\"AlbumId\" HAVING SUM(t.\"Milliseconds\") > 3600000 ORDER BY \"TotalMinutes\" DESC;"
  },
  {
    "question": "Find customers who have purchased the same track more than once",
    "sql": "SELECT i.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", t.\"TrackId\", t.\"Name\" AS \"TrackName\", COUNT(il.\"InvoiceLineId\") AS \"PurchaseCount\" FROM \"Invoice\" i JOIN \"Customer\" c ON i.\"CustomerId\" = c.\"CustomerId\" JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" GROUP BY i.\"CustomerId\", t.\"TrackId\" HAVING COUNT(il.\"InvoiceLineId\") > 1;"
  },
  {
    "question": "What is the percentage of invoices that include a track from each genre?",
    "sql": "SELECT g.\"Name\" AS \"Genre\", COUNT(DISTINCT i.\"InvoiceId\") AS \"InvoicesWithGenre\", ROUND(COUNT(DISTINCT i.\"InvoiceId\") * 100.0 / (SELECT COUNT(*) FROM \"Invoice\"), 2) AS \"Percentage\" FROM \"Genre\" g JOIN \"Track\" t ON g.\"GenreId\" = t.\"GenreId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" JOIN \"Invoice\" i ON il.\"InvoiceId\" = i.\"InvoiceId\" GROUP BY g.\"Name\" ORDER BY \"Percentage\" DESC;"
  },
  {
    "question": "List all employees who have never been a support representative",
    "sql": "SELECT e.\"EmployeeId\", e.\"FirstName\" || ' ' || e.\"LastName\" AS \"EmployeeName\" FROM \"Employee\" e LEFT JOIN \"Customer\" c ON e.\"EmployeeId\" = c.\"SupportRepId\" WHERE c.\"SupportRepId\" IS NULL;"
  },
  {
    "question": "Find the top 3 most profitable customers by year",
    "sql": "WITH CustomerYearlySales AS (SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", strftime('%Y', i.\"InvoiceDate\") AS \"Year\", SUM(i.\"Total\") AS \"YearlyTotal\", ROW_NUMBER() OVER (PARTITION BY strftime('%Y', i.\"InvoiceDate\") ORDER BY SUM(i.\"Total\") DESC) AS \"Rank\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY c.\"CustomerId\", \"Year\") SELECT \"Year\", \"CustomerName\", \"YearlyTotal\" FROM CustomerYearlySales WHERE \"Rank\" <= 3 ORDER BY \"Year\", \"Rank\";"
  },
  {
    "question": "What is the average number of invoices per customer by country?",
    "sql": "SELECT c.\"Country\", AVG(\"InvoiceCount\") AS \"AvgInvoicesPerCustomer\" FROM (SELECT \"CustomerId\", COUNT(*) AS \"InvoiceCount\" FROM \"Invoice\" GROUP BY \"CustomerId\") ic JOIN \"Customer\" c ON ic.\"CustomerId\" = c.\"CustomerId\" GROUP BY c.\"Country\" ORDER BY \"AvgInvoicesPerCustomer\" DESC;"
  },
  {
    "question": "List all tracks that have a unit price of $0.99 and are longer than 3 minutes",
    "sql": "SELECT \"Name\", \"Milliseconds\" / 60000 AS \"Minutes\" FROM \"Track\" WHERE \"UnitPrice\" = 0.99 AND \"Milliseconds\" > 180000 ORDER BY \"Milliseconds\" DESC;"
  },
  {
    "question": "Find the artist with the highest average track length",
    "sql": "SELECT ar.\"Name\" AS \"Artist\", AVG(t.\"Milliseconds\") / 60000 AS \"AvgMinutes\" FROM \"Artist\" ar JOIN \"Album\" al ON ar.\"ArtistId\" = al.\"ArtistId\" JOIN \"Track\" t ON al.\"AlbumId\" = t.\"AlbumId\" GROUP BY ar.\"ArtistId\" ORDER BY \"AvgMinutes\" DESC LIMIT 1;"
  },
  {
    "question": "What is the total sales per customer per year, including customers with no sales?",
    "sql": "WITH Years AS (SELECT DISTINCT strftime('%Y', \"InvoiceDate\") AS \"Year\" FROM \"Invoice\"), CustomerYears AS (SELECT c.\"CustomerId\", y.\"Year\" FROM \"Customer\" c CROSS JOIN Years y) SELECT cy.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", cy.\"Year\", COALESCE(SUM(i.\"Total\"), 0) AS \"YearlySales\" FROM CustomerYears cy JOIN \"Customer\" c ON cy.\"CustomerId\" = c.\"CustomerId\" LEFT JOIN \"Invoice\" i ON cy.\"CustomerId\" = i.\"CustomerId\" AND cy.\"Year\" = strftime('%Y', i.\"InvoiceDate\") GROUP BY cy.\"CustomerId\", cy.\"Year\" ORDER BY cy.\"CustomerId\", cy.\"Year\";"
  },
  {
    "question": "List all playlists that contain the maximum number of tracks",
    "sql": "WITH PlaylistTrackCounts AS (SELECT \"PlaylistId\", COUNT(*) AS \"TrackCount\" FROM \"PlaylistTrack\" GROUP BY \"PlaylistId\") SELECT p.\"Name\", ptc.\"TrackCount\" FROM \"Playlist\" p JOIN PlaylistTrackCounts ptc ON p.\"PlaylistId\" = ptc.\"PlaylistId\" WHERE ptc.\"TrackCount\" = (SELECT MAX(\"TrackCount\") FROM PlaylistTrackCounts);"
  },
  {
    "question": "Find customers who have made purchases in at least 3 different countries",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", COUNT(DISTINCT i.\"BillingCountry\") AS \"CountryCount\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY c.\"CustomerId\" HAVING COUNT(DISTINCT i.\"BillingCountry\") >= 3;"
  },
  {
    "question": "What is the revenue contribution of the top 10% of customers?",
    "sql": "WITH CustomerSales AS (SELECT \"CustomerId\", SUM(\"Total\") AS \"TotalSpent\", NTILE(10) OVER (ORDER BY SUM(\"Total\") DESC) AS \"Decile\" FROM \"Invoice\" GROUP BY \"CustomerId\") SELECT SUM(\"TotalSpent\") AS \"Top10PercentRevenue\", (SELECT SUM(\"TotalSpent\") FROM CustomerSales) AS \"TotalRevenue\", ROUND(SUM(\"TotalSpent\") * 100.0 / (SELECT SUM(\"TotalSpent\") FROM CustomerSales), 2) AS \"Percentage\" FROM CustomerSales WHERE \"Decile\" = 1;"
  },
  {
    "question": "List all albums that have tracks from multiple genres",
    "sql": "SELECT al.\"AlbumId\", al.\"Title\", COUNT(DISTINCT t.\"GenreId\") AS \"GenreCount\" FROM \"Album\" al JOIN \"Track\" t ON al.\"AlbumId\" = t.\"AlbumId\" GROUP BY al.\"AlbumId\" HAVING COUNT(DISTINCT t.\"GenreId\") > 1 ORDER BY \"GenreCount\" DESC;"
  },
  {
    "question": "Find the most common pair of genres purchased together",
    "sql": "WITH InvoiceGenres AS (SELECT il.\"InvoiceId\", g.\"GenreId\", g.\"Name\" AS \"GenreName\" FROM \"InvoiceLine\" il JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"Genre\" g ON t.\"GenreId\" = g.\"GenreId\"), GenrePairs AS (SELECT ig1.\"InvoiceId\", ig1.\"GenreName\" AS \"Genre1\", ig2.\"GenreName\" AS \"Genre2\" FROM InvoiceGenres ig1 JOIN InvoiceGenres ig2 ON ig1.\"InvoiceId\" = ig2.\"InvoiceId\" AND ig1.\"GenreId\" < ig2.\"GenreId\") SELECT \"Genre1\", \"Genre2\", COUNT(*) AS \"TimesTogether\" FROM GenrePairs GROUP BY \"Genre1\", \"Genre2\" ORDER BY \"TimesTogether\" DESC LIMIT 1;"
  },
  {
    "question": "What is the average track price by genre?",
    "sql": "SELECT g.\"Name\" AS \"Genre\", AVG(t.\"UnitPrice\") AS \"AvgPrice\" FROM \"Genre\" g JOIN \"Track\" t ON g.\"GenreId\" = t.\"GenreId\" GROUP BY g.\"Name\" ORDER BY \"AvgPrice\" DESC;"
  },
  {
    "question": "List all customers who have made a purchase every month in 2009",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" WHERE strftime('%Y', i.\"InvoiceDate\") = '2009' GROUP BY c.\"CustomerId\" HAVING COUNT(DISTINCT strftime('%m', i.\"InvoiceDate\")) = 12;"
  },
  {
    "question": "Find the track that has been purchased by the most distinct customers",
    "sql": "SELECT t.\"TrackId\", t.\"Name\", COUNT(DISTINCT i.\"CustomerId\") AS \"CustomerCount\" FROM \"Track\" t JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" JOIN \"Invoice\" i ON il.\"InvoiceId\" = i.\"InvoiceId\" GROUP BY t.\"TrackId\" ORDER BY \"CustomerCount\" DESC LIMIT 1;"
  },
  {
    "question": "What is the total revenue by country and year?",
    "sql": "SELECT i.\"BillingCountry\" AS \"Country\", strftime('%Y', i.\"InvoiceDate\") AS \"Year\", SUM(i.\"Total\") AS \"Revenue\" FROM \"Invoice\" i GROUP BY \"Country\", \"Year\" ORDER BY \"Country\", \"Year\";"
  },
  {
    "question": "List all employees who have the same hire year",
    "sql": "SELECT strftime('%Y', \"HireDate\") AS \"HireYear\", GROUP_CONCAT(\"FirstName\" || ' ' || \"LastName\", ', ') AS \"Employees\" FROM \"Employee\" GROUP BY \"HireYear\" ORDER BY \"HireYear\";"
  },
  {
    "question": "Find customers who have purchased tracks from more than 10 different artists",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", COUNT(DISTINCT a.\"ArtistId\") AS \"ArtistCount\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"Album\" al ON t.\"AlbumId\" = al.\"AlbumId\" JOIN \"Artist\" a ON al.\"ArtistId\" = a.\"ArtistId\" GROUP BY c.\"CustomerId\" HAVING COUNT(DISTINCT a.\"ArtistId\") > 10;"
  },
  {
    "question": "What is the median invoice total?",
    "sql": "SELECT AVG(\"Total\") AS \"MedianInvoiceTotal\" FROM (SELECT \"Total\", ROW_NUMBER() OVER (ORDER BY \"Total\") AS \"RowAsc\", ROW_NUMBER() OVER (ORDER BY \"Total\" DESC) AS \"RowDesc\" FROM \"Invoice\") WHERE \"RowAsc\" IN (\"RowDesc\", \"RowDesc\" - 1, \"RowDesc\" + 1);"
  },
  {
    "question": "List all tracks that are the only track in their genre",
    "sql": "SELECT t.\"Name\", g.\"Name\" AS \"Genre\" FROM \"Track\" t JOIN \"Genre\" g ON t.\"GenreId\" = g.\"GenreId\" WHERE g.\"GenreId\" IN (SELECT \"GenreId\" FROM \"Track\" GROUP BY \"GenreId\" HAVING COUNT(*) = 1);"
  },
  {
    "question": "Find the top 3 countries by average customer spending",
    "sql": "SELECT c.\"Country\", AVG(c.\"TotalSpent\") AS \"AvgCustomerSpending\" FROM (SELECT \"CustomerId\", SUM(\"Total\") AS \"TotalSpent\" FROM \"Invoice\" GROUP BY \"CustomerId\") cs JOIN \"Customer\" c ON cs.\"CustomerId\" = c.\"CustomerId\" GROUP BY c.\"Country\" ORDER BY \"AvgCustomerSpending\" DESC LIMIT 3;"
  },
  {
    "question": "What is the total sales for each support representative?",
    "sql": "SELECT e.\"EmployeeId\", e.\"FirstName\" || ' ' || e.\"LastName\" AS \"SupportRep\", SUM(i.\"Total\") AS \"TotalSales\" FROM \"Employee\" e JOIN \"Customer\" c ON e.\"EmployeeId\" = c.\"SupportRepId\" JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY e.\"EmployeeId\" ORDER BY \"TotalSales\" DESC;"
  },
  {
    "question": "List all invoices that were issued on a weekend",
    "sql": "SELECT \"InvoiceId\", \"InvoiceDate\", \"Total\" FROM \"Invoice\" WHERE strftime('%w', \"InvoiceDate\") IN ('0', '6') ORDER BY \"InvoiceDate\";"
  },
  {
    "question": "Find the artist with the most diverse genre portfolio",
    "sql": "SELECT ar.\"Name\" AS \"Artist\", COUNT(DISTINCT t.\"GenreId\") AS \"GenreCount\" FROM \"Artist\" ar JOIN \"Album\" al ON ar.\"ArtistId\" = al.\"ArtistId\" JOIN \"Track\" t ON al.\"AlbumId\" = t.\"AlbumId\" GROUP BY ar.\"ArtistId\" ORDER BY \"GenreCount\" DESC LIMIT 1;"
  },
  {
    "question": "What is the customer churn rate by year?",
    "sql": "WITH CustomerActivity AS (SELECT \"CustomerId\", strftime('%Y', \"InvoiceDate\") AS \"Year\", LAG(strftime('%Y', \"InvoiceDate\")) OVER (PARTITION BY \"CustomerId\" ORDER BY \"InvoiceDate\") AS \"PrevYear\" FROM \"Invoice\" GROUP BY \"CustomerId\", \"Year\"), ChurnedCustomers AS (SELECT \"Year\", COUNT(DISTINCT \"CustomerId\") AS \"ChurnedCount\" FROM CustomerActivity WHERE \"PrevYear\" IS NOT NULL AND CAST(\"Year\" AS INTEGER) - CAST(\"PrevYear\" AS INTEGER) > 1 GROUP BY \"Year\") SELECT c.\"Year\", c.\"ChurnedCount\", COUNT(DISTINCT ca.\"CustomerId\") AS \"ActiveCustomers\", ROUND(c.\"ChurnedCount\" * 100.0 / COUNT(DISTINCT ca.\"CustomerId\"), 2) AS \"ChurnRate\" FROM ChurnedCustomers c JOIN CustomerActivity ca ON c.\"Year\" = ca.\"Year\" GROUP BY c.\"Year\" ORDER BY c.\"Year\";"
  },
  {
    "question": "List all albums that have no tracks in the 'Rock' genre",
    "sql": "SELECT al.\"AlbumId\", al.\"Title\" FROM \"Album\" al WHERE al.\"AlbumId\" NOT IN (SELECT DISTINCT t.\"AlbumId\" FROM \"Track\" t JOIN \"Genre\" g ON t.\"GenreId\" = g.\"GenreId\" WHERE g.\"Name\" = 'Rock');"
  },
  {
    "question": "Find the top 3 tracks with the highest sales in each country",
    "sql": "WITH CountryTrackSales AS (SELECT i.\"BillingCountry\" AS \"Country\", t.\"TrackId\", t.\"Name\" AS \"TrackName\", ar.\"Name\" AS \"ArtistName\", SUM(il.\"UnitPrice\" * il.\"Quantity\") AS \"Sales\", ROW_NUMBER() OVER (PARTITION BY i.\"BillingCountry\" ORDER BY SUM(il.\"UnitPrice\" * il.\"Quantity\") DESC) AS \"Rank\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"Album\" a ON t.\"AlbumId\" = a.\"AlbumId\" JOIN \"Artist\" ar ON a.\"ArtistId\" = ar.\"ArtistId\" GROUP BY i.\"BillingCountry\", t.\"TrackId\") SELECT \"Country\", \"TrackName\", \"ArtistName\", \"Sales\" FROM CountryTrackSales WHERE \"Rank\" <= 3 ORDER BY \"Country\", \"Rank\";"
  },
  {
    "question": "What is the average number of tracks per playlist?",
    "sql": "SELECT AVG(\"TrackCount\") AS \"AvgTracksPerPlaylist\" FROM (SELECT \"PlaylistId\", COUNT(*) AS \"TrackCount\" FROM \"PlaylistTrack\" GROUP BY \"PlaylistId\");"
  },
  {
    "question": "List all customers who have spent more than $50 in a single purchase",
    "sql": "SELECT DISTINCT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" WHERE i.\"Total\" > 50;"
  },
  {
    "question": "Find the most popular album in each country",
    "sql": "WITH CountryAlbumSales AS (SELECT i.\"BillingCountry\" AS \"Country\", al.\"AlbumId\", al.\"Title\" AS \"AlbumTitle\", ar.\"Name\" AS \"ArtistName\", COUNT(il.\"InvoiceLineId\") AS \"PurchaseCount\", ROW_NUMBER() OVER (PARTITION BY i.\"BillingCountry\" ORDER BY COUNT(il.\"InvoiceLineId\") DESC) AS \"Rank\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"Album\" al ON t.\"AlbumId\" = al.\"AlbumId\" JOIN \"Artist\" ar ON al.\"ArtistId\" = ar.\"ArtistId\" GROUP BY i.\"BillingCountry\", al.\"AlbumId\") SELECT \"Country\", \"AlbumTitle\", \"ArtistName\", \"PurchaseCount\" FROM CountryAlbumSales WHERE \"Rank\" = 1 ORDER BY \"Country\";"
  },
  {
    "question": "What is the year-over-year sales growth?",
    "sql": "WITH YearlySales AS (SELECT strftime('%Y', \"InvoiceDate\") AS \"Year\", SUM(\"Total\") AS \"Sales\" FROM \"Invoice\" GROUP BY \"Year\") SELECT \"Year\", \"Sales\", LAG(\"Sales\") OVER (ORDER BY \"Year\") AS \"PreviousYearSales\", ROUND((\"Sales\" - LAG(\"Sales\") OVER (ORDER BY \"Year\")) * 100.0 / LAG(\"Sales\") OVER (ORDER BY \"Year\"), 2) AS \"GrowthPercentage\" FROM YearlySales ORDER BY \"Year\";"
  },
  {
    "question": "List all tracks that are in playlists but have never been purchased",
    "sql": "SELECT DISTINCT t.\"TrackId\", t.\"Name\" FROM \"Track\" t JOIN \"PlaylistTrack\" pt ON t.\"TrackId\" = pt.\"TrackId\" LEFT JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" WHERE il.\"InvoiceLineId\" IS NULL;"
  },
  {
    "question": "Find the customer who has purchased the most tracks overall",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", COUNT(il.\"InvoiceLineId\") AS \"TracksPurchased\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" GROUP BY c.\"CustomerId\" ORDER BY \"TracksPurchased\" DESC LIMIT 1;"
  },
  {
    "question": "What is the total revenue from customers who have a support representative?",
    "sql": "SELECT SUM(i.\"Total\") AS \"RevenueWithSupport\" FROM \"Invoice\" i WHERE i.\"CustomerId\" IN (SELECT \"CustomerId\" FROM \"Customer\" WHERE \"SupportRepId\" IS NOT NULL);"
  },
  {
    "question": "List all genres and the number of tracks in each, with tracks longer than the average",
    "sql": "SELECT g.\"Name\" AS \"Genre\", COUNT(t.\"TrackId\") AS \"LongTrackCount\" FROM \"Genre\" g JOIN \"Track\" t ON g.\"GenreId\" = t.\"GenreId\" WHERE t.\"Milliseconds\" > (SELECT AVG(\"Milliseconds\") FROM \"Track\") GROUP BY g.\"Name\" ORDER BY \"LongTrackCount\" DESC;"
  },
  {
    "question": "Find the top 3 months with the highest sales for each year",
    "sql": "WITH MonthlySales AS (SELECT strftime('%Y', \"InvoiceDate\") AS \"Year\", strftime('%m', \"InvoiceDate\") AS \"Month\", SUM(\"Total\") AS \"Sales\", ROW_NUMBER() OVER (PARTITION BY strftime('%Y', \"InvoiceDate\") ORDER BY SUM(\"Total\") DESC) AS \"Rank\" FROM \"Invoice\" GROUP BY \"Year\", \"Month\") SELECT \"Year\", \"Month\", \"Sales\" FROM MonthlySales WHERE \"Rank\" <= 3 ORDER BY \"Year\", \"Rank\";"
  },
  {
    "question": "What is the percentage of customers who have made a repeat purchase?",
    "sql": "SELECT ROUND(COUNT(DISTINCT CASE WHEN \"PurchaseCount\" > 1 THEN \"CustomerId\" END) * 100.0 / COUNT(DISTINCT \"CustomerId\"), 2) AS \"RepeatCustomerPercentage\" FROM (SELECT \"CustomerId\", COUNT(*) AS \"PurchaseCount\" FROM \"Invoice\" GROUP BY \"CustomerId\");"
  },
  {
    "question": "List all artists who have never had a track purchased",
    "sql": "SELECT ar.\"ArtistId\", ar.\"Name\" FROM \"Artist\" ar WHERE ar.\"ArtistId\" NOT IN (SELECT DISTINCT a.\"ArtistId\" FROM \"Album\" a JOIN \"Track\" t ON a.\"AlbumId\" = t.\"AlbumId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\");"
  },
  {
    "question": "Find the average sales amount per invoice by day of week",
    "sql": "SELECT CASE strftime('%w', \"InvoiceDate\") WHEN '0' THEN 'Sunday' WHEN '1' THEN 'Monday' WHEN '2' THEN 'Tuesday' WHEN '3' THEN 'Wednesday' WHEN '4' THEN 'Thursday' WHEN '5' THEN 'Friday' ELSE 'Saturday' END AS \"DayOfWeek\", AVG(\"Total\") AS \"AvgSales\" FROM \"Invoice\" GROUP BY strftime('%w', \"InvoiceDate\") ORDER BY strftime('%w', \"InvoiceDate\");"
  },
  {
    "question": "List all customers who have only purchased tracks from a single genre",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"Genre\" g ON t.\"GenreId\" = g.\"GenreId\" GROUP BY c.\"CustomerId\" HAVING COUNT(DISTINCT g.\"GenreId\") = 1;"
  },
  {
    "question": "What is the total duration of all tracks in each playlist in hours?",
    "sql": "SELECT p.\"Name\" AS \"Playlist\", ROUND(SUM(t.\"Milliseconds\") / 3600000.0, 2) AS \"TotalHours\" FROM \"Playlist\" p JOIN \"PlaylistTrack\" pt ON p.\"PlaylistId\" = pt.\"PlaylistId\" JOIN \"Track\" t ON pt.\"TrackId\" = t.\"TrackId\" GROUP BY p.\"Name\" ORDER BY \"TotalHours\" DESC;"
  },
  {
    "question": "Find the track that has the most variation in price (if any)",
    "sql": "SELECT \"Name\", MIN(\"UnitPrice\") AS \"MinPrice\", MAX(\"UnitPrice\") AS \"MaxPrice\", MAX(\"UnitPrice\") - MIN(\"UnitPrice\") AS \"PriceRange\" FROM \"Track\" GROUP BY \"Name\" HAVING COUNT(DISTINCT \"UnitPrice\") > 1;"
  },
  {
    "question": "What is the sales distribution by customer city?",
    "sql": "SELECT c.\"City\", c.\"Country\", SUM(i.\"Total\") AS \"TotalSales\", COUNT(DISTINCT c.\"CustomerId\") AS \"CustomerCount\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY c.\"City\", c.\"Country\" ORDER BY \"TotalSales\" DESC;"
  },
  {
    "question": "List all invoices that have more than the average number of tracks",
    "sql": "SELECT i.\"InvoiceId\", i.\"Total\", COUNT(il.\"InvoiceLineId\") AS \"TrackCount\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" GROUP BY i.\"InvoiceId\" HAVING COUNT(il.\"InvoiceLineId\") > (SELECT AVG(\"TrackCount\") FROM (SELECT COUNT(*) AS \"TrackCount\" FROM \"InvoiceLine\" GROUP BY \"InvoiceId\")) ORDER BY \"TrackCount\" DESC;"
  },
  {
    "question": "Find the top 3 artists with the most tracks purchased",
    "sql": "SELECT ar.\"Name\" AS \"Artist\", COUNT(il.\"InvoiceLineId\") AS \"TracksPurchased\" FROM \"Artist\" ar JOIN \"Album\" al ON ar.\"ArtistId\" = al.\"ArtistId\" JOIN \"Track\" t ON al.\"AlbumId\" = t.\"AlbumId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY ar.\"ArtistId\" ORDER BY \"TracksPurchased\" DESC LIMIT 3;"
  },
  {
    "question": "What is the monthly active customer count?",
    "sql": "SELECT strftime('%Y-%m', \"InvoiceDate\") AS \"Month\", COUNT(DISTINCT \"CustomerId\") AS \"ActiveCustomers\" FROM \"Invoice\" GROUP BY \"Month\" ORDER BY \"Month\";"
  },
  {
    "question": "List all customers who have never made a purchase in their home country",
    "sql": "SELECT DISTINCT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", c.\"Country\" FROM \"Customer\" c WHERE c.\"CustomerId\" NOT IN (SELECT i.\"CustomerId\" FROM \"Invoice\" i WHERE i.\"BillingCountry\" = c.\"Country\");"
  },
  {
    "question": "Find the album with the most tracks",
    "sql": "SELECT al.\"Title\", ar.\"Name\" AS \"Artist\", COUNT(t.\"TrackId\") AS \"TrackCount\" FROM \"Album\" al JOIN \"Artist\" ar ON al.\"ArtistId\" = ar.\"ArtistId\" JOIN \"Track\" t ON al.\"AlbumId\" = t.\"AlbumId\" GROUP BY al.\"AlbumId\" ORDER BY \"TrackCount\" DESC LIMIT 1;"
  },
  {
    "question": "What is the total revenue from each media type by year?",
    "sql": "SELECT strftime('%Y', i.\"InvoiceDate\") AS \"Year\", mt.\"Name\" AS \"MediaType\", SUM(il.\"UnitPrice\" * il.\"Quantity\") AS \"Revenue\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"MediaType\" mt ON t.\"MediaTypeId\" = mt.\"MediaTypeId\" GROUP BY \"Year\", mt.\"Name\" ORDER BY \"Year\", \"Revenue\" DESC;"
  },
  {
    "question": "List all customers who have purchased tracks from every media type",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"MediaType\" mt ON t.\"MediaTypeId\" = mt.\"MediaTypeId\" GROUP BY c.\"CustomerId\" HAVING COUNT(DISTINCT mt.\"MediaTypeId\") = (SELECT COUNT(*) FROM \"MediaType\");"
  },
  {
    "question": "Find the most profitable customer by country",
    "sql": "WITH CustomerCountrySales AS (SELECT c.\"Country\", c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", SUM(i.\"Total\") AS \"TotalSpent\", ROW_NUMBER() OVER (PARTITION BY c.\"Country\" ORDER BY SUM(i.\"Total\") DESC) AS \"Rank\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY c.\"Country\", c.\"CustomerId\") SELECT \"Country\", \"CustomerName\", \"TotalSpent\" FROM CustomerCountrySales WHERE \"Rank\" = 1 ORDER BY \"Country\";"
  },
  {
    "question": "What is the average time between purchases for repeat customers?",
    "sql": "WITH CustomerPurchaseGaps AS (SELECT \"CustomerId\", julianday(\"InvoiceDate\") - julianday(LAG(\"InvoiceDate\") OVER (PARTITION BY \"CustomerId\" ORDER BY \"InvoiceDate\")) AS \"DaysBetween\" FROM \"Invoice\") SELECT AVG(\"DaysBetween\") AS \"AvgDaysBetweenPurchases\" FROM CustomerPurchaseGaps WHERE \"DaysBetween\" IS NOT NULL;"
  },
  {
    "question": "List all tracks that are the longest in their album",
    "sql": "WITH AlbumMaxLength AS (SELECT \"AlbumId\", MAX(\"Milliseconds\") AS \"MaxLength\" FROM \"Track\" GROUP BY \"AlbumId\") SELECT t.\"Name\", al.\"Title\" AS \"Album\", t.\"Milliseconds\" / 60000 AS \"Minutes\" FROM \"Track\" t JOIN \"Album\" al ON t.\"AlbumId\" = al.\"AlbumId\" JOIN AlbumMaxLength aml ON t.\"AlbumId\" = aml.\"AlbumId\" AND t.\"Milliseconds\" = aml.\"MaxLength\" ORDER BY t.\"Milliseconds\" DESC;"
  },
  {
    "question": "Find the top 3 most common first names among customers",
    "sql": "SELECT \"FirstName\", COUNT(*) AS \"Count\" FROM \"Customer\" GROUP BY \"FirstName\" ORDER BY \"Count\" DESC LIMIT 3;"
  },
  {
    "question": "What is the total sales for each postal code in the USA?",
    "sql": "SELECT \"PostalCode\", SUM(i.\"Total\") AS \"TotalSales\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" WHERE c.\"Country\" = 'USA' AND \"PostalCode\" IS NOT NULL GROUP BY \"PostalCode\" ORDER BY \"TotalSales\" DESC;"
  },
  {
    "question": "List all employees who have the same birth year as their hire year",
    "sql": "SELECT \"FirstName\" || ' ' || \"LastName\" AS \"EmployeeName\", \"BirthDate\", \"HireDate\" FROM \"Employee\" WHERE strftime('%Y', \"BirthDate\") = strftime('%Y', \"HireDate\");"
  },
  {
    "question": "Find the average track length for each composer with more than 5 tracks",
    "sql": "SELECT \"Composer\", AVG(\"Milliseconds\") / 60000 AS \"AvgMinutes\", COUNT(*) AS \"TrackCount\" FROM \"Track\" WHERE \"Composer\" IS NOT NULL GROUP BY \"Composer\" HAVING COUNT(*) > 5 ORDER BY \"AvgMinutes\" DESC;"
  },
  {
    "question": "What is the percentage of invoices that include tracks from multiple media types?",
    "sql": "SELECT ROUND(COUNT(DISTINCT CASE WHEN \"MediaTypeCount\" > 1 THEN \"InvoiceId\" END) * 100.0 / COUNT(DISTINCT \"InvoiceId\"), 2) AS \"Percentage\" FROM (SELECT i.\"InvoiceId\", COUNT(DISTINCT t.\"MediaTypeId\") AS \"MediaTypeCount\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" GROUP BY i.\"InvoiceId\");"
  },
  {
    "question": "List all customers who have made a purchase every year since 2009",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\" FROM \"Customer\" c WHERE NOT EXISTS (SELECT DISTINCT strftime('%Y', \"InvoiceDate\") AS \"Year\" FROM \"Invoice\" WHERE strftime('%Y', \"InvoiceDate\") >= '2009' EXCEPT SELECT DISTINCT strftime('%Y', i.\"InvoiceDate\") FROM \"Invoice\" i WHERE i.\"CustomerId\" = c.\"CustomerId\" AND strftime('%Y', i.\"InvoiceDate\") >= '2009');"
  },
  {
    "question": "Find the track that appears in the most playlists",
    "sql": "SELECT t.\"TrackId\", t.\"Name\", COUNT(pt.\"PlaylistId\") AS \"PlaylistCount\" FROM \"Track\" t JOIN \"PlaylistTrack\" pt ON t.\"TrackId\" = pt.\"TrackId\" GROUP BY t.\"TrackId\" ORDER BY \"PlaylistCount\" DESC LIMIT 1;"
  },
  {
    "question": "What is the total revenue by state for USA customers?",
    "sql": "SELECT c.\"State\", SUM(i.\"Total\") AS \"Revenue\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" WHERE c.\"Country\" = 'USA' AND c.\"State\" IS NOT NULL GROUP BY c.\"State\" ORDER BY \"Revenue\" DESC;"
  },
  {
    "question": "List all albums that have been purchased in their entirety (every track purchased)",
    "sql": "SELECT al.\"AlbumId\", al.\"Title\" FROM \"Album\" al WHERE NOT EXISTS (SELECT t.\"TrackId\" FROM \"Track\" t WHERE t.\"AlbumId\" = al.\"AlbumId\" AND t.\"TrackId\" NOT IN (SELECT DISTINCT il.\"TrackId\" FROM \"InvoiceLine\" il));"
  },
  {
    "question": "Find the top 3 customers who have the highest average tracks per invoice",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", AVG(\"TracksPerInvoice\") AS \"AvgTracksPerInvoice\" FROM \"Customer\" c JOIN (SELECT i.\"CustomerId\", i.\"InvoiceId\", COUNT(il.\"InvoiceLineId\") AS \"TracksPerInvoice\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" GROUP BY i.\"InvoiceId\") tpi ON c.\"CustomerId\" = tpi.\"CustomerId\" GROUP BY c.\"CustomerId\" ORDER BY \"AvgTracksPerInvoice\" DESC LIMIT 3;"
  },
  {
    "question": "What is the sales distribution by hour of day for each country?",
    "sql": "SELECT i.\"BillingCountry\", strftime('%H', i.\"InvoiceDate\") AS \"Hour\", COUNT(*) AS \"InvoiceCount\", SUM(i.\"Total\") AS \"TotalSales\" FROM \"Invoice\" i GROUP BY i.\"BillingCountry\", \"Hour\" ORDER BY i.\"BillingCountry\", \"Hour\";"
  },
  {
    "question": "List all playlists that contain tracks from only one genre",
    "sql": "SELECT p.\"PlaylistId\", p.\"Name\" FROM \"Playlist\" p JOIN \"PlaylistTrack\" pt ON p.\"PlaylistId\" = pt.\"PlaylistId\" JOIN \"Track\" t ON pt.\"TrackId\" = t.\"TrackId\" GROUP BY p.\"PlaylistId\" HAVING COUNT(DISTINCT t.\"GenreId\") = 1;"
  },
  {
    "question": "Find the artist whose tracks have the highest average sales per track",
    "sql": "SELECT ar.\"Name\" AS \"Artist\", AVG(\"TrackSales\") AS \"AvgSalesPerTrack\" FROM \"Artist\" ar JOIN \"Album\" al ON ar.\"ArtistId\" = al.\"ArtistId\" JOIN (SELECT t.\"AlbumId\", t.\"TrackId\", SUM(il.\"UnitPrice\" * il.\"Quantity\") AS \"TrackSales\" FROM \"Track\" t LEFT JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY t.\"TrackId\") ts ON al.\"AlbumId\" = ts.\"AlbumId\" GROUP BY ar.\"ArtistId\" ORDER BY \"AvgSalesPerTrack\" DESC LIMIT 1;"
  },
  {
    "question": "What is the customer lifetime value distribution?",
    "sql": "SELECT CASE WHEN \"TotalSpent\" < 10 THEN 'Under $10' WHEN \"TotalSpent\" BETWEEN 10 AND 25 THEN '$10-$25' WHEN \"TotalSpent\" BETWEEN 25.01 AND 50 THEN '$25-$50' WHEN \"TotalSpent\" BETWEEN 50.01 AND 100 THEN '$50-$100' ELSE 'Over $100' END AS \"SpendingSegment\", COUNT(*) AS \"CustomerCount\" FROM (SELECT \"CustomerId\", SUM(\"Total\") AS \"TotalSpent\" FROM \"Invoice\" GROUP BY \"CustomerId\") GROUP BY \"SpendingSegment\" ORDER BY MIN(\"TotalSpent\");"
  },
  {
    "question": "List all invoices where the customer's country differs from the billing country",
    "sql": "SELECT i.\"InvoiceId\", c.\"Country\" AS \"CustomerCountry\", i.\"BillingCountry\" FROM \"Invoice\" i JOIN \"Customer\" c ON i.\"CustomerId\" = c.\"CustomerId\" WHERE c.\"Country\" != i.\"BillingCountry\";"
  },
  {
    "question": "Find the top 5 most common track names",
    "sql": "SELECT \"Name\", COUNT(*) AS \"Count\" FROM \"Track\" GROUP BY \"Name\" ORDER BY \"Count\" DESC LIMIT 5;"
  },
  {
    "question": "What is the total number of customers acquired by each support representative?",
    "sql": "SELECT e.\"EmployeeId\", e.\"FirstName\" || ' ' || e.\"LastName\" AS \"SupportRep\", COUNT(c.\"CustomerId\") AS \"CustomersAcquired\" FROM \"Employee\" e JOIN \"Customer\" c ON e.\"EmployeeId\" = c.\"SupportRepId\" GROUP BY e.\"EmployeeId\" ORDER BY \"CustomersAcquired\" DESC;"
  },
  {
    "question": "List all tracks that have been purchased by customers from at least 3 different countries",
    "sql": "SELECT t.\"TrackId\", t.\"Name\", COUNT(DISTINCT i.\"BillingCountry\") AS \"CountryCount\" FROM \"Track\" t JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" JOIN \"Invoice\" i ON il.\"InvoiceId\" = i.\"InvoiceId\" GROUP BY t.\"TrackId\" HAVING COUNT(DISTINCT i.\"BillingCountry\") >= 3 ORDER BY \"CountryCount\" DESC;"
  },
  {
    "question": "Find the average number of playlists each track belongs to",
    "sql": "SELECT AVG(\"PlaylistCount\") AS \"AvgPlaylistsPerTrack\" FROM (SELECT t.\"TrackId\", COUNT(pt.\"PlaylistId\") AS \"PlaylistCount\" FROM \"Track\" t LEFT JOIN \"PlaylistTrack\" pt ON t.\"TrackId\" = pt.\"TrackId\" GROUP BY t.\"TrackId\");"
  },
  {
    "question": "What is the total revenue from invoices that include at least one track longer than 8 minutes?",
    "sql": "SELECT SUM(DISTINCT i.\"Total\") AS \"Revenue\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" WHERE t.\"Milliseconds\" > 480000;"
  },
  {
    "question": "List all customers who have the same first name as their support representative",
    "sql": "SELECT c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", e.\"FirstName\" || ' ' || e.\"LastName\" AS \"SupportRepName\" FROM \"Customer\" c JOIN \"Employee\" e ON c.\"SupportRepId\" = e.\"EmployeeId\" WHERE c.\"FirstName\" = e.\"FirstName\";"
  },
  {
    "question": "Find the top 3 albums with the highest percentage of tracks purchased",
    "sql": "SELECT al.\"AlbumId\", al.\"Title\", ar.\"Name\" AS \"Artist\", COUNT(DISTINCT CASE WHEN il.\"InvoiceLineId\" IS NOT NULL THEN t.\"TrackId\" END) AS \"PurchasedTracks\", COUNT(t.\"TrackId\") AS \"TotalTracks\", ROUND(COUNT(DISTINCT CASE WHEN il.\"InvoiceLineId\" IS NOT NULL THEN t.\"TrackId\" END) * 100.0 / COUNT(t.\"TrackId\"), 2) AS \"PurchasePercentage\" FROM \"Album\" al JOIN \"Artist\" ar ON al.\"ArtistId\" = ar.\"ArtistId\" JOIN \"Track\" t ON al.\"AlbumId\" = t.\"AlbumId\" LEFT JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY al.\"AlbumId\" HAVING COUNT(t.\"TrackId\") > 0 ORDER BY \"PurchasePercentage\" DESC LIMIT 3;"
  },
  {
    "question": "What is the monthly sales growth rate for 2010?",
    "sql": "WITH MonthlySales2010 AS (SELECT strftime('%m', \"InvoiceDate\") AS \"Month\", SUM(\"Total\") AS \"Sales\" FROM \"Invoice\" WHERE strftime('%Y', \"InvoiceDate\") = '2010' GROUP BY \"Month\") SELECT \"Month\", \"Sales\", LAG(\"Sales\") OVER (ORDER BY \"Month\") AS \"PreviousMonthSales\", ROUND((\"Sales\" - LAG(\"Sales\") OVER (ORDER BY \"Month\")) * 100.0 / LAG(\"Sales\") OVER (ORDER BY \"Month\"), 2) AS \"GrowthRate\" FROM MonthlySales2010 ORDER BY \"Month\";"
  },
  {
    "question": "List all playlists that contain tracks from exactly 3 different artists",
    "sql": "SELECT p.\"PlaylistId\", p.\"Name\" FROM \"Playlist\" p JOIN \"PlaylistTrack\" pt ON p.\"PlaylistId\" = pt.\"PlaylistId\" JOIN \"Track\" t ON pt.\"TrackId\" = t.\"TrackId\" JOIN \"Album\" a ON t.\"AlbumId\" = a.\"AlbumId\" GROUP BY p.\"PlaylistId\" HAVING COUNT(DISTINCT a.\"ArtistId\") = 3;"
  },
  {
    "question": "Find the customers who have the largest gap between their first and last purchase",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", MIN(i.\"InvoiceDate\") AS \"FirstPurchase\", MAX(i.\"InvoiceDate\") AS \"LastPurchase\", julianday(MAX(i.\"InvoiceDate\")) - julianday(MIN(i.\"InvoiceDate\")) AS \"DaysActive\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY c.\"CustomerId\" ORDER BY \"DaysActive\" DESC LIMIT 5;"
  },
  {
    "question": "What is the average price of tracks in each media type?",
    "sql": "SELECT mt.\"Name\" AS \"MediaType\", AVG(t.\"UnitPrice\") AS \"AvgPrice\" FROM \"MediaType\" mt JOIN \"Track\" t ON mt.\"MediaTypeId\" = t.\"MediaTypeId\" GROUP BY mt.\"Name\" ORDER BY \"AvgPrice\" DESC;"
  },
  {
    "question": "List all invoices that have a total that is exactly the sum of its track prices",
    "sql": "SELECT i.\"InvoiceId\", i.\"Total\" FROM \"Invoice\" i WHERE i.\"Total\" = (SELECT SUM(il.\"UnitPrice\" * il.\"Quantity\") FROM \"InvoiceLine\" il WHERE il.\"InvoiceId\" = i.\"InvoiceId\");"
  },
  {
    "question": "Find the top 3 genres by number of customers who have purchased from them",
    "sql": "SELECT g.\"Name\" AS \"Genre\", COUNT(DISTINCT i.\"CustomerId\") AS \"CustomerCount\" FROM \"Genre\" g JOIN \"Track\" t ON g.\"GenreId\" = t.\"GenreId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" JOIN \"Invoice\" i ON il.\"InvoiceId\" = i.\"InvoiceId\" GROUP BY g.\"Name\" ORDER BY \"CustomerCount\" DESC LIMIT 3;"
  },
  {
    "question": "What is the total sales per employee, including those with no customers?",
    "sql": "SELECT e.\"EmployeeId\", e.\"FirstName\" || ' ' || e.\"LastName\" AS \"EmployeeName\", COALESCE(SUM(i.\"Total\"), 0) AS \"TotalSales\" FROM \"Employee\" e LEFT JOIN \"Customer\" c ON e.\"EmployeeId\" = c.\"SupportRepId\" LEFT JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY e.\"EmployeeId\" ORDER BY \"TotalSales\" DESC;"
  },
  {
    "question": "List all tracks that have the same name as another track by a different artist",
    "sql": "SELECT t1.\"Name\", ar1.\"Name\" AS \"Artist1\", ar2.\"Name\" AS \"Artist2\" FROM \"Track\" t1 JOIN \"Album\" a1 ON t1.\"AlbumId\" = a1.\"AlbumId\" JOIN \"Artist\" ar1 ON a1.\"ArtistId\" = ar1.\"ArtistId\" JOIN \"Track\" t2 ON t1.\"Name\" = t2.\"Name\" AND t1.\"TrackId\" != t2.\"TrackId\" JOIN \"Album\" a2 ON t2.\"AlbumId\" = a2.\"AlbumId\" JOIN \"Artist\" ar2 ON a2.\"ArtistId\" = ar2.\"ArtistId\" WHERE ar1.\"ArtistId\" != ar2.\"ArtistId\" GROUP BY t1.\"Name\", ar1.\"Name\", ar2.\"Name\";"
  },
  {
    "question": "Find the artist with the highest percentage of their tracks purchased",
    "sql": "SELECT ar.\"Name\" AS \"Artist\", COUNT(DISTINCT CASE WHEN il.\"InvoiceLineId\" IS NOT NULL THEN t.\"TrackId\" END) AS \"PurchasedTracks\", COUNT(DISTINCT t.\"TrackId\") AS \"TotalTracks\", ROUND(COUNT(DISTINCT CASE WHEN il.\"InvoiceLineId\" IS NOT NULL THEN t.\"TrackId\" END) * 100.0 / COUNT(DISTINCT t.\"TrackId\"), 2) AS \"PurchasePercentage\" FROM \"Artist\" ar JOIN \"Album\" al ON ar.\"ArtistId\" = al.\"ArtistId\" JOIN \"Track\" t ON al.\"AlbumId\" = t.\"AlbumId\" LEFT JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY ar.\"ArtistId\" HAVING COUNT(DISTINCT t.\"TrackId\") > 0 ORDER BY \"PurchasePercentage\" DESC LIMIT 1;"
  },
  {
    "question": "What is the average number of invoices per customer by year of first purchase?",
    "sql": "WITH CustomerFirstYear AS (SELECT \"CustomerId\", MIN(strftime('%Y', \"InvoiceDate\")) AS \"FirstYear\" FROM \"Invoice\" GROUP BY \"CustomerId\"), CustomerInvoiceCounts AS (SELECT c.\"CustomerId\", cfy.\"FirstYear\", COUNT(i.\"InvoiceId\") AS \"InvoiceCount\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" JOIN CustomerFirstYear cfy ON c.\"CustomerId\" = cfy.\"CustomerId\" GROUP BY c.\"CustomerId\") SELECT \"FirstYear\", AVG(\"InvoiceCount\") AS \"AvgInvoicesPerCustomer\" FROM CustomerInvoiceCounts GROUP BY \"FirstYear\" ORDER BY \"FirstYear\";"
  },
  {
    "question": "List all customers who have purchased more tracks than the average customer",
    "sql": "WITH CustomerTrackCounts AS (SELECT i.\"CustomerId\", COUNT(il.\"InvoiceLineId\") AS \"TrackCount\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" GROUP BY i.\"CustomerId\") SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", ctc.\"TrackCount\" FROM \"Customer\" c JOIN CustomerTrackCounts ctc ON c.\"CustomerId\" = ctc.\"CustomerId\" WHERE ctc.\"TrackCount\" > (SELECT AVG(\"TrackCount\") FROM CustomerTrackCounts) ORDER BY ctc.\"TrackCount\" DESC;"
  },
  {
    "question": "Find the most common invoice total amount",
    "sql": "SELECT \"Total\", COUNT(*) AS \"Frequency\" FROM \"Invoice\" GROUP BY \"Total\" ORDER BY \"Frequency\" DESC LIMIT 1;"
  },
  {
    "question": "What is the total revenue from customers who have a Gmail email address?",
    "sql": "SELECT SUM(i.\"Total\") AS \"Revenue\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" WHERE c.\"Email\" LIKE '%@gmail.com';"
  },
  {
    "question": "List all playlists that have a total duration between 1 and 2 hours",
    "sql": "SELECT p.\"Name\" AS \"Playlist\", SUM(t.\"Milliseconds\") / 60000 AS \"TotalMinutes\" FROM \"Playlist\" p JOIN \"PlaylistTrack\" pt ON p.\"PlaylistId\" = pt.\"PlaylistId\" JOIN \"Track\" t ON pt.\"TrackId\" = t.\"TrackId\" GROUP BY p.\"Name\" HAVING SUM(t.\"Milliseconds\") BETWEEN 3600000 AND 7200000 ORDER BY \"TotalMinutes\";"
  },
  {
    "question": "Find the top 5 tracks that have the highest ratio of sales to length",
    "sql": "SELECT t.\"Name\", ar.\"Name\" AS \"Artist\", COUNT(il.\"InvoiceLineId\") AS \"TimesPurchased\", t.\"Milliseconds\" / 60000 AS \"Minutes\", ROUND(COUNT(il.\"InvoiceLineId\") * 1.0 / (t.\"Milliseconds\" / 60000.0), 4) AS \"SalesPerMinute\" FROM \"Track\" t JOIN \"Album\" a ON t.\"AlbumId\" = a.\"AlbumId\" JOIN \"Artist\" ar ON a.\"ArtistId\" = ar.\"ArtistId\" LEFT JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" GROUP BY t.\"TrackId\" HAVING COUNT(il.\"InvoiceLineId\") > 0 ORDER BY \"SalesPerMinute\" DESC LIMIT 5;"
  },
  {
    "question": "What is the customer concentration by country (percentage of total customers)?",
    "sql": "SELECT \"Country\", COUNT(*) AS \"CustomerCount\", ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM \"Customer\"), 2) AS \"Percentage\", SUM(COUNT(*)) OVER (ORDER BY COUNT(*) DESC) AS \"CumulativeCount\", ROUND(SUM(COUNT(*)) OVER (ORDER BY COUNT(*) DESC) * 100.0 / (SELECT COUNT(*) FROM \"Customer\"), 2) AS \"CumulativePercentage\" FROM \"Customer\" GROUP BY \"Country\" ORDER BY \"CustomerCount\" DESC;"
  },
  {
    "question": "List all invoices that were issued in the same month as the customer's birthday",
    "sql": "SELECT i.\"InvoiceId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", i.\"InvoiceDate\", c.\"BirthDate\" FROM \"Invoice\" i JOIN \"Customer\" c ON i.\"CustomerId\" = c.\"CustomerId\" WHERE c.\"BirthDate\" IS NOT NULL AND strftime('%m', i.\"InvoiceDate\") = strftime('%m', c.\"BirthDate\");"
  },
  {
    "question": "Find the average number of tracks per album by genre",
    "sql": "SELECT g.\"Name\" AS \"Genre\", AVG(\"TrackCount\") AS \"AvgTracksPerAlbum\" FROM \"Genre\" g JOIN (SELECT t.\"GenreId\", t.\"AlbumId\", COUNT(*) AS \"TrackCount\" FROM \"Track\" t GROUP BY t.\"AlbumId\", t.\"GenreId\") ta ON g.\"GenreId\" = ta.\"GenreId\" GROUP BY g.\"Name\" ORDER BY \"AvgTracksPerAlbum\" DESC;"
  },
  {
    "question": "What is the total sales for each day of the week in 2010?",
    "sql": "SELECT CASE strftime('%w', \"InvoiceDate\") WHEN '0' THEN 'Sunday' WHEN '1' THEN 'Monday' WHEN '2' THEN 'Tuesday' WHEN '3' THEN 'Wednesday' WHEN '4' THEN 'Thursday' WHEN '5' THEN 'Friday' ELSE 'Saturday' END AS \"DayOfWeek\", SUM(\"Total\") AS \"TotalSales\" FROM \"Invoice\" WHERE strftime('%Y', \"InvoiceDate\") = '2010' GROUP BY strftime('%w', \"InvoiceDate\") ORDER BY strftime('%w', \"InvoiceDate\");"
  },
  {
    "question": "List all customers who have made purchases in every quarter of 2009",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" WHERE strftime('%Y', i.\"InvoiceDate\") = '2009' GROUP BY c.\"CustomerId\" HAVING COUNT(DISTINCT CASE WHEN strftime('%m', i.\"InvoiceDate\") IN ('01','02','03') THEN 'Q1' WHEN strftime('%m', i.\"InvoiceDate\") IN ('04','05','06') THEN 'Q2' WHEN strftime('%m', i.\"InvoiceDate\") IN ('07','08','09') THEN 'Q3' ELSE 'Q4' END) = 4;"
  },
  {
    "question": "Find the top 3 most valuable customers by total spending, including their favorite genre",
    "sql": "WITH CustomerTopGenre AS (SELECT i.\"CustomerId\", g.\"Name\" AS \"Genre\", COUNT(il.\"InvoiceLineId\") AS \"GenreCount\", ROW_NUMBER() OVER (PARTITION BY i.\"CustomerId\" ORDER BY COUNT(il.\"InvoiceLineId\") DESC) AS \"Rank\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"Genre\" g ON t.\"GenreId\" = g.\"GenreId\" GROUP BY i.\"CustomerId\", g.\"Name\") SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", SUM(i.\"Total\") AS \"TotalSpent\", ctg.\"Genre\" AS \"FavoriteGenre\" FROM \"Customer\" c JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" LEFT JOIN CustomerTopGenre ctg ON c.\"CustomerId\" = ctg.\"CustomerId\" AND ctg.\"Rank\" = 1 GROUP BY c.\"CustomerId\" ORDER BY \"TotalSpent\" DESC LIMIT 3;"
  },
  {
    "question": "What is the total number of tracks sold broken down by composer?",
    "sql": "SELECT t.\"Composer\", COUNT(il.\"InvoiceLineId\") AS \"TracksSold\" FROM \"Track\" t JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" WHERE t.\"Composer\" IS NOT NULL GROUP BY t.\"Composer\" ORDER BY \"TracksSold\" DESC;"
  },
  {
    "question": "List all invoices where the number of tracks is greater than the average for that customer",
    "sql": "WITH CustomerAvg AS (SELECT i.\"CustomerId\", AVG(\"TrackCount\") AS \"AvgTracks\" FROM (SELECT i.\"CustomerId\", i.\"InvoiceId\", COUNT(il.\"InvoiceLineId\") AS \"TrackCount\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" GROUP BY i.\"InvoiceId\") i GROUP BY i.\"CustomerId\") SELECT i.\"InvoiceId\", i.\"CustomerId\", COUNT(il.\"InvoiceLineId\") AS \"TrackCount\", ca.\"AvgTracks\" FROM \"Invoice\" i JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN CustomerAvg ca ON i.\"CustomerId\" = ca.\"CustomerId\" GROUP BY i.\"InvoiceId\" HAVING COUNT(il.\"InvoiceLineId\") > ca.\"AvgTracks\";"
  },
  {
    "question": "Find the most common pair of artists purchased together",
    "sql": "WITH InvoiceArtists AS (SELECT il.\"InvoiceId\", a.\"ArtistId\", ar.\"Name\" AS \"ArtistName\" FROM \"InvoiceLine\" il JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"Album\" al ON t.\"AlbumId\" = al.\"AlbumId\" JOIN \"Artist\" ar ON al.\"ArtistId\" = ar.\"ArtistId\"), ArtistPairs AS (SELECT ia1.\"InvoiceId\", ia1.\"ArtistName\" AS \"Artist1\", ia2.\"ArtistName\" AS \"Artist2\" FROM InvoiceArtists ia1 JOIN InvoiceArtists ia2 ON ia1.\"InvoiceId\" = ia2.\"InvoiceId\" AND ia1.\"ArtistId\" < ia2.\"ArtistId\") SELECT \"Artist1\", \"Artist2\", COUNT(*) AS \"TimesTogether\" FROM ArtistPairs GROUP BY \"Artist1\", \"Artist2\" ORDER BY \"TimesTogether\" DESC LIMIT 1;"
  },
  {
    "question": "What is the average time between purchases for each customer?",
    "sql": "SELECT c.\"CustomerId\", c.\"FirstName\" || ' ' || c.\"LastName\" AS \"CustomerName\", AVG(julianday(\"NextPurchase\") - julianday(\"InvoiceDate\")) AS \"AvgDaysBetween\" FROM (SELECT \"CustomerId\", \"InvoiceDate\", LEAD(\"InvoiceDate\") OVER (PARTITION BY \"CustomerId\" ORDER BY \"InvoiceDate\") AS \"NextPurchase\" FROM \"Invoice\") ip JOIN \"Customer\" c ON ip.\"CustomerId\" = c.\"CustomerId\" WHERE \"NextPurchase\" IS NOT NULL GROUP BY c.\"CustomerId\" ORDER BY \"AvgDaysBetween\";"
  },
  {
    "question": "List all tracks that have been purchased by customers from the same country as the artist",
    "sql": "SELECT DISTINCT t.\"Name\", ar.\"Name\" AS \"Artist\", c.\"Country\" FROM \"Track\" t JOIN \"Album\" a ON t.\"AlbumId\" = a.\"AlbumId\" JOIN \"Artist\" ar ON a.\"ArtistId\" = ar.\"ArtistId\" JOIN \"InvoiceLine\" il ON t.\"TrackId\" = il.\"TrackId\" JOIN \"Invoice\" i ON il.\"InvoiceId\" = i.\"InvoiceId\" JOIN \"Customer\" c ON i.\"CustomerId\" = c.\"CustomerId\" WHERE c.\"Country\" = 'USA';"
  },
  {
    "question": "Find the top 3 employees who have generated the most revenue through their customers",
    "sql": "SELECT e.\"EmployeeId\", e.\"FirstName\" || ' ' || e.\"LastName\" AS \"EmployeeName\", SUM(i.\"Total\") AS \"RevenueGenerated\" FROM \"Employee\" e JOIN \"Customer\" c ON e.\"EmployeeId\" = c.\"SupportRepId\" JOIN \"Invoice\" i ON c.\"CustomerId\" = i.\"CustomerId\" GROUP BY e.\"EmployeeId\" ORDER BY \"RevenueGenerated\" DESC LIMIT 3;"
  },
  {
    "question": "What is the percentage of invoices that include tracks from the customer's home country's artists?",
    "sql": "WITH InvoiceHomeArtist AS (SELECT DISTINCT i.\"InvoiceId\", c.\"Country\" FROM \"Invoice\" i JOIN \"Customer\" c ON i.\"CustomerId\" = c.\"CustomerId\" JOIN \"InvoiceLine\" il ON i.\"InvoiceId\" = il.\"InvoiceId\" JOIN \"Track\" t ON il.\"TrackId\" = t.\"TrackId\" JOIN \"Album\" a ON t.\"AlbumId\" = a.\"AlbumId\" JOIN \"Artist\" ar ON a.\"ArtistId\" = ar.\"ArtistId\" WHERE ar.\"Country\" = c.\"Country\") SELECT ROUND(COUNT(DISTINCT i.\"InvoiceId\") * 100.0 / (SELECT COUNT(*) FROM \"Invoice\"), 2) AS \"Percentage\" FROM \"Invoice\" i WHERE i.\"InvoiceId\" IN (SELECT \"InvoiceId\" FROM InvoiceHomeArtist);"
  }
  

]